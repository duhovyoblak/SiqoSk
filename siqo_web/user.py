#==============================================================================
#  SIQO web library: Function for SIQO Flask application
#------------------------------------------------------------------------------
import os

from werkzeug.security          import generate_password_hash, check_password_hash
from   flask_login              import UserMixin

import sqlite3
import siqo_lib.general   as gen


#==============================================================================
# package's constants
#------------------------------------------------------------------------------
_VER      = 1.00
_CWD      = os.getcwd()
_DBFILE   = f"{_CWD}/static/data/user.db"
_IS_TEST  = True if os.environ['wsiqo-test-mode']=='1' else False

#==============================================================================
# package's variables
#------------------------------------------------------------------------------
con = sqlite3.connect(_DBFILE)

#==============================================================================
# package's variables
#------------------------------------------------------------------------------

#==============================================================================
# Class User
#------------------------------------------------------------------------------
class User(UserMixin):
    
    #==========================================================================
    # Constructor & utilities
    #--------------------------------------------------------------------------
    def __init__(self, journal):
        "Call constructor of User"

        self.journal = journal
        self.journal.I("User.init:")
        
        self.cur    = con.cursor()      # Cursor in DB User
        
        self.journal.O()
        
    #==========================================================================
    # Internal methods
    #--------------------------------------------------------------------------
    def loadDB(self):
        
        self.journal.I(f"{self.name}.loadDB:")
        
        
        #----------------------------------------------------------------------
        # Ak subor user.json neexistuje, potom ho vytvorim
        #----------------------------------------------------------------------
        if self.dbUser is None: self.saveDB()
        
        
        #----------------------------------------------------------------------
        self.journal.O()
        
    #--------------------------------------------------------------------------
    def saveDB(self):
        
        self.journal.I(f"{self.name}.saveDB:")
        
        
        #----------------------------------------------------------------------
        # Ak subor user.json neexistuje, potom ho vytvorim
        #----------------------------------------------------------------------
        if self.dbUser is None: self.saveDB()
        
        
        #----------------------------------------------------------------------
        self.journal.O()
        
    #==========================================================================
    # API for users
    #--------------------------------------------------------------------------

#==============================================================================
# Test cases
#------------------------------------------------------------------------------
if _IS_TEST:
    
    from   siqo_lib    import SiqoJournal
    journal = SiqoJournal('TEST user', debug=5)
   
    
    user = User(journal)

#==============================================================================
print(f"User {_VER}")

#==============================================================================
#                              END OF FILE
#------------------------------------------------------------------------------
